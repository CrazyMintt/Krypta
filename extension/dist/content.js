(()=>{"use strict";let e=null;const t=()=>{const e=document.getElementById("krypta-suggestions");e&&e.remove()},o=(e,t)=>{var o;const n=null===(o=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value"))||void 0===o?void 0:o.set;n?n.call(e,t):e.value=t;const s=new Event("input",{bubbles:!0});e.dispatchEvent(s)},n=n=>{const s=n.target;chrome.runtime.sendMessage({action:"getCredentials",url:window.location.href},n=>{n&&n.credentials&&((n,s)=>{if(t(),e=s,0===n.length)return;const r=document.createElement("div");r.id="krypta-suggestions",r.style.position="absolute",r.style.zIndex="9999",r.style.border="1px solid #555",r.style.backgroundColor="#333",r.style.color="#eee",r.style.borderRadius="4px",r.style.boxShadow="0 2px 5px rgba(0,0,0,0.5)";const l=s.getBoundingClientRect();r.style.top=`${window.scrollY+l.bottom}px`,r.style.left=`${window.scrollX+l.left}px`,r.style.width=`${l.width}px`,n.forEach(n=>{const s=document.createElement("div");s.style.padding="8px",s.style.cursor="pointer",s.setAttribute("tabindex","-1"),s.textContent=`${n.nome_aplicacao} (${n.senha.email})`,s.style.backgroundColor="transparent",s.style.color="inherit",s.onmouseover=()=>{s.style.backgroundColor="#555"},s.onmouseout=()=>{s.style.backgroundColor="transparent"},s.onclick=()=>{if(e){const{usernameInput:t,passwordInput:s}=(e=>{var t,o;let n=null,s=null;const r=e.closest("form")||document,l=Array.from(r.querySelectorAll("input")),a=l.filter(e=>"password"===e.type);a.length>0&&(s=a.find(e=>"current-password"===e.autocomplete)||a[0]);const i=l.filter(e=>("text"===e.type||"email"===e.type)&&e!==s),d=["user","email","login","username","e-mail","identifier"];let c=null,u=0;for(const e of i){let n=0;const s=e.name.toLowerCase(),l=e.id.toLowerCase(),a=e.placeholder.toLowerCase(),i=e.autocomplete.toLowerCase(),p=(null===(t=e.getAttribute("aria-label"))||void 0===t?void 0:t.toLowerCase())||"";"email"===e.type&&(n+=5),"username"===i&&(n+=10),i.includes("email")&&(n+=5);const m=[s,l,a,p];for(const e of m)for(const t of d)e.includes(t)&&n++;if(e.id){const t=r.querySelector(`label[for="${e.id}"]`);if(t){const e=(null===(o=t.textContent)||void 0===o?void 0:o.toLowerCase())||"";for(const t of d)e.includes(t)&&(n+=2)}}n>u&&(u=n,c=e)}if(n=c,"password"===e.type&&!n&&s){const e=l.indexOf(s);if(e>0){const t=l[e-1];!t||"text"!==t.type&&"email"!==t.type||(n=t)}}return{usernameInput:n,passwordInput:s}})(e);t&&o(t,n.senha.email),s&&o(s,"decrypted_password_placeholder")}t()},r.appendChild(s)}),document.body.appendChild(r)})(n.credentials,s)})},s=e=>{e.querySelectorAll('input:not([data-krypta-attached="true"])').forEach(e=>{(e=>{e.dataset.kryptaAttached||(e=>{const t=e.type.toLowerCase(),o=e.name.toLowerCase(),n=e.autocomplete.toLowerCase(),s=e.id.toLowerCase();return"email"===t||"password"===t||"text"===t&&(o.includes("user")||o.includes("email")||o.includes("login")||s.includes("user")||s.includes("email")||s.includes("login")||n.includes("username")||n.includes("email"))})(e)&&(e.addEventListener("focus",n),e.dataset.kryptaAttached="true")})(e)}),e.querySelectorAll("*").forEach(e=>{e.shadowRoot&&(e.shadowRoot.kryptaProcessed||(e.shadowRoot.kryptaProcessed=!0,s(e.shadowRoot)))})};s(document),new MutationObserver(e=>{s(document)}).observe(document.body,{childList:!0,subtree:!0});const r=o=>{setTimeout(()=>{const n=document.getElementById("krypta-suggestions");if(!n)return;let s=null;o instanceof FocusEvent?s=o.relatedTarget:o instanceof MouseEvent&&(s=o.target),n.contains(s)||s===e||t()},100)};document.addEventListener("click",r),document.addEventListener("focusout",r)})();